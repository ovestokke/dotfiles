{{ if ne .chezmoi.os "windows" -}}
#!/bin/bash
# Sync agent and skill files to chezmoi
# Agents live in ~/.claude/agents/
# Skills live in ~/.agents/skills/ and are symlinked into ~/.claude/skills/

AGENTS_DIR="$HOME/.agents"
CLAUDE_AGENTS_DIR="$HOME/.claude/agents"
CLAUDE_SKILLS_DIR="$HOME/.claude/skills"

mkdir -p "$AGENTS_DIR/skills" "$CLAUDE_SKILLS_DIR"

echo "Syncing agent files..."

# Add agent .md files from ~/.claude/agents/ to chezmoi
for agent in "$CLAUDE_AGENTS_DIR"/*.md; do
    [ -f "$agent" ] || continue
    chezmoi add "$agent" 2>/dev/null || true
done

# Symlink skill dirs from ~/.agents/skills/ into ~/.claude/skills/
for skill in "$AGENTS_DIR/skills"/*/; do
    [ -d "$skill" ] || continue
    name="$(basename "$skill")"
    target="$CLAUDE_SKILLS_DIR/$name"
    [ -L "$target" ] && continue
    ln -sf "../../.agents/skills/$name" "$target"
done

# Add skill files to chezmoi
for skill in "$AGENTS_DIR/skills"/*/*; do
    [ -f "$skill" ] || continue
    chezmoi add "$skill" 2>/dev/null || true
done

[ -f "$AGENTS_DIR/.skill-lock.json" ] && chezmoi add "$AGENTS_DIR/.skill-lock.json" 2>/dev/null || true

echo "Agent sync complete."
{{- end }}
