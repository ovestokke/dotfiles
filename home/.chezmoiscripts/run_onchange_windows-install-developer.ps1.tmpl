{{- if eq .chezmoi.os "windows" }}
# developer.yaml hash: {{ include ".chezmoidata/windows/developer.yaml" | sha256sum }}

Write-Host "Installing Windows developer packages via winget..." -ForegroundColor Cyan

if (-not (Get-Command winget -ErrorAction SilentlyContinue)) {
    Write-Host "[SKIP] winget not found, skipping package installation" -ForegroundColor Yellow
    exit 0
}

$failed = @()
$succeeded = @()

{{ range .packages.windows.developer -}}
Write-Host "Installing: {{ . }}" -ForegroundColor Cyan
winget install --id {{ . | quote }} --silent --accept-package-agreements --accept-source-agreements
if ($LASTEXITCODE -eq 0 -or $LASTEXITCODE -eq -1978335189) {
    $succeeded += "{{ . }}"
} else {
    $failed += "{{ . }}"
}
{{ end -}}

Write-Host "`nInstallation Summary:" -ForegroundColor Cyan
Write-Host "Succeeded: $($succeeded.Count)" -ForegroundColor Green
Write-Host "Failed: $($failed.Count)" -ForegroundColor $(if ($failed.Count -gt 0) { "Red" } else { "Green" })

if ($failed.Count -gt 0) {
    Write-Host "`nFailed packages:" -ForegroundColor Red
    $failed | ForEach-Object { Write-Host "  - $_" -ForegroundColor Red }
}
{{- end }}
